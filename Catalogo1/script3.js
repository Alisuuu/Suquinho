window.App=window.App||{};App.UI=App.UI||{};App.UI.elements={searchInput:document.getElementById('searchInput'),resultsGrid:document.getElementById('resultsGrid'),itemModal:document.getElementById('itemModal'),modalBody:document.getElementById('modalBody'),closeModalButton:document.getElementById('closeModalButton'),episodePlayerModal:document.getElementById('episodePlayerModal'),closeEpisodeModalButton:document.getElementById('closeEpisodeModalButton'),episodePlayerTitleEl:document.getElementById('episodePlayerTitle'),copyEpisodeLinkBtn:document.getElementById('copyEpisodeLinkBtn'),loader:document.getElementById('loader'),noResultsMessage:document.getElementById('noResults'),currentViewTitleEl:document.getElementById('currentViewTitle'),btnExplore:document.getElementById('btnExplore'),btnMovies:document.getElementById('btnMovies'),btnSeries:document.getElementById('btnSeries'),btnChannels:document.getElementById('btnChannels'),categoryButtons:[document.getElementById('btnExplore'),document.getElementById('btnMovies'),document.getElementById('btnSeries'),document.getElementById('btnChannels')]};App.UI.state={currentItemModalPlayerUrl:'',currentEpisodePlayerUrl:'',isItemModalOpen:!1,isEpisodeModalOpen:!1};App.UI.showToast=e=>{const t=document.querySelector('.toast-message');t&&t.remove();const s=document.createElement('div');s.className='toast-message',s.textContent=e,document.body.appendChild(s),setTimeout(()=>s.remove(),3e3)};App.UI.setActiveButton=e=>{App.UI.elements.categoryButtons.forEach(t=>t.classList.remove('active')),e&&e.classList.add('active')};App.UI.displayResults=(e,t,s)=>{App.UI.elements.resultsGrid&&(App.UI.elements.resultsGrid.innerHTML='');const a=e?e.filter(e=>e.poster_path||e.logo_url):[];if(App.UI.elements.noResultsMessage){if(0===a.length){const e=t&&t.toLowerCase().startsWith('resultados da busca por:')?t.match(/Resultados da Busca por: "([^"]*)"/)?t.match(/Resultados da Busca por: "([^"]*)"/)[1]:App.UI.elements.searchInput.value.trim():'Nenhum item encontrado nesta categoria.';return App.UI.elements.noResultsMessage.textContent=`Nenhum resultado encontrado para "${e}".`,void App.UI.elements.noResultsMessage.classList.remove('hidden')}App.UI.elements.noResultsMessage.classList.add('hidden')}a.forEach(e=>{const t=e.media_type||(e.title?'movie':'tv'),a=document.createElement('div');a.className='item-card rounded-lg shadow-lg cursor-pointer overflow-hidden flex flex-col',a.addEventListener('click',()=>s(e.id||e.channel_id,t));const r=document.createElement('img');r.src=e.poster_path?`${App.Constants.IMAGE_BASE_URL}${e.poster_path}`:e.logo_url||`https://placehold.co/500x750/101010/581c87?text=Indispon%C3%ADvel`,r.alt=e.title||e.name||e.channel_name,r.className='w-full h-auto object-cover aspect-[2/3]',r.onerror=()=>{r.src='https://placehold.co/500x750/101010/581c87?text=Indispon%C3%ADvel',r.alt='Imagem Indisponível'};const i=document.createElement('div');i.className='p-3 flex flex-col flex-grow';const o=document.createElement('h3');o.className='text-md font-semibold text-violet-300 truncate mb-1',o.textContent=e.title||e.name||e.channel_name,o.title=e.title||e.name||e.channel_name;const n=e.release_date||e.first_air_date,l=document.createElement('p');l.className='text-xs text-gray-500',l.textContent=n?new Date(n).getFullYear():'Ano N/A',i.appendChild(o),i.appendChild(l),a.appendChild(r),a.appendChild(i),App.UI.elements.resultsGrid&&App.UI.elements.resultsGrid.appendChild(a)})};App.UI.loadVideoPlayer=(e,t='EpisodeEmbedderIframeContainer')=>{const s=document.getElementById(t);if(!s)return console.error(`Elemento '${t}' não encontrado.`),void('EmbedderIframeContainer'===t?App.UI.state.currentItemModalPlayerUrl='':'EpisodeEmbedderIframeContainer'===t&&(App.UI.state.currentEpisodePlayerUrl=''));s.innerHTML='';let a;if(e.includes('.m3u8')||e.includes('.mp4')||e.includes('.webm')||e.includes('.ogg')){a=document.createElement('video'),a.src=e,a.controls=!0,a.autoplay=!0,a.setAttribute('playsinline',''),a.style.width='100%',a.style.height='450px',a.style.borderRadius='.75rem',a.style.backgroundColor='#000'}else if(e.includes('http')||e.includes('https')){a=document.createElement('iframe'),a.src=e,a.setAttribute('scrolling','no'),a.setAttribute('frameborder','0'),a.setAttribute('allowfullscreen',''),a.setAttribute('webkitallowfullscreen',''),a.setAttribute('mozallowfullscreen',''),a.style.width='100%',a.style.height='450px',a.style.borderRadius='.75rem',a.style.backgroundColor='#000'}else return console.error(`Formato de URL de vídeo não suportado: ${e}`),void(s.innerHTML='<p class="text-center text-red-400 py-4">Formato de vídeo não suportado.</p>');'EmbedderIframeContainer'===t?App.UI.state.currentItemModalPlayerUrl=e:'EpisodeEmbedderIframeContainer'===t&&(App.UI.state.currentEpisodePlayerUrl=e),s.appendChild(a)};App.UI.setItemModalOpen=e=>{App.UI.state.isItemModalOpen=e,e?(App.UI.elements.itemModal&& (App.UI.elements.itemModal.style.display='flex'),document.body.style.overflow='hidden'):(App.UI.elements.itemModal&& (App.UI.elements.itemModal.style.display='none'),App.UI.elements.modalBody&& (App.UI.elements.modalBody.innerHTML=''),document.body.style.overflow='auto')};App.UI.setEpisodeModalOpen=e=>{App.UI.state.isEpisodeModalOpen=e,e?(App.UI.elements.episodePlayerModal&& (App.UI.elements.episodePlayerModal.style.display='flex'),App.UI.state.isItemModalOpen&&App.UI.elements.itemModal&& (App.UI.elements.itemModal.style.zIndex='900')):(App.UI.elements.episodePlayerModal&& (App.UI.elements.episodePlayerModal.style.display='none'),document.getElementById('EpisodeEmbedderIframeContainer')&& (document.getElementById('EpisodeEmbedderIframeContainer').innerHTML=''),App.UI.state.isItemModalOpen&&App.UI.elements.itemModal&& (App.UI.elements.itemModal.style.zIndex='1000'))};App.UI.initDisplay=async(e,t,s,a={},r=2)=>{App.UI.elements.currentViewTitleEl&& (App.UI.elements.currentViewTitleEl.textContent=t),App.UI.setActiveButton(s),App.UI.elements.loader&&App.UI.elements.loader.classList.remove('hidden'),App.UI.elements.resultsGrid&& (App.UI.elements.resultsGrid.innerHTML=''),App.UI.elements.noResultsMessage&&App.UI.elements.noResultsMessage.classList.add('hidden');try{const t=await App.API.fetchMultiplePages(e,a,r);App.UI.displayResults(t?.results||[],t,App.ModalHandlers.fetchItemDetails)}catch(e){console.error('Erro ao carregar dados na UI:',e),App.UI.elements.currentViewTitleEl&& (App.UI.elements.currentViewTitleEl.textContent='Erro ao Carregar Dados'),App.UI.elements.noResultsMessage&&(App.UI.elements.noResultsMessage.textContent='Não foi possível carregar. Verifique sua conexão e a chave da API.',App.UI.elements.noResultsMessage.classList.remove('hidden')),App.UI.displayResults([],t,App.ModalHandlers.fetchItemDetails)}finally{App.UI.elements.loader&&App.UI.elements.loader.classList.add('hidden')}};
